---
// src/components/SermonCard.astro
interface Props {
  title: string;
  pastor: string;
  date: string;
  description: string;
  videoId: string;
  duration: string;
  category: string;
  watchText: string;
}

const {
  title,
  pastor,
  date,
  description,
  videoId,
  duration,
  category,
  watchText,
} = Astro.props;

const modalId = `modal-${videoId}`;
---

<div
  class="sermon-card bg-secondary/95 dark:bg-secondary/5 rounded-3xl overflow-hidden shadow-lg dark:shadow-secondary/5 border border-secondary/10 dark:border-secondary/10"
  data-category={category}
>
  <div class="grid md:grid-cols-2 gap-8 p-8">
    <div
      class="aspect-video bg-dark/5 dark:bg-dark/50 rounded-2xl overflow-hidden relative shadow-md group"
    >
      <img
        src={`https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`}
        alt={title}
        class="w-full h-full object-cover cursor-pointer transition-transform duration-500 group-hover:scale-105"
        data-modal-target={modalId}
      />
      <div class="absolute inset-0 flex items-center justify-center">
        <button
          class="watch-button p-4 rounded-full bg-accent/90 hover:bg-accent transition-all transform hover:scale-110 shadow-lg hover:shadow-accent/20"
          data-modal-target={modalId}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-12 w-12 text-light drop-shadow-lg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M8 5v14l11-7z"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="flex flex-col justify-center">
      <div class="flex flex-wrap items-center gap-4 mb-4">
        <span class="text-accent font-bold tracking-wide">{pastor}</span>
        <span class="text-dark/40 dark:text-light/40">•</span>
        <span class="text-dark/80 dark:text-light/80">{date}</span>
        <span class="text-dark/40 dark:text-light/40">•</span>
        <span class="text-dark/80 dark:text-light/80">{duration}</span>
      </div>
      <h2
        class="text-3xl font-display font-bold mb-4 text-dark dark:text-light"
      >
        {title}
      </h2>
      <p class="text-xl text-dark/80 dark:text-light/80 mb-8 leading-relaxed">
        {description}
      </p>
      <div class="flex flex-wrap gap-4">
        <button
          class="watch-button px-8 py-4 bg-accent text-white rounded-full font-bold hover:bg-accent/80 transition-all hover:shadow-xl hover:shadow-accent/30 hover:scale-105 active:scale-95 active:bg-accent/70 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent"
          data-modal-target={modalId}
        >
          {watchText}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  id={modalId}
  class="fixed inset-0 bg-dark/95 z-50 hidden items-center justify-center p-4 backdrop-blur-sm"
>
  <div
    class="relative w-full max-w-5xl aspect-video bg-dark rounded-2xl overflow-hidden shadow-2xl border border-light/10"
  >
    <button
      class="close-modal absolute top-4 right-4 text-light hover:text-accent z-10 p-3 bg-dark/80 rounded-full transition-all hover:bg-dark/95 hover:scale-110"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
    <div id={`iframe-container-${videoId}`} class="w-full h-full"></div>
  </div>
</div>

<script>
  function initializeModal(modalId: string, videoId: string) {
    const modal = document.getElementById(modalId);
    const triggers = document.querySelectorAll(
      `[data-modal-target="${modalId}"]`,
    );
    const closeButton = modal?.querySelector(".close-modal");
    const iframeContainer = document.getElementById(
      `iframe-container-${videoId}`,
    );

    function openModal() {
      if (modal && iframeContainer) {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        document.body.style.overflow = "hidden";

        iframeContainer.innerHTML = `
          <iframe
            width="100%"
            height="100%"
            src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0"
            title="YouTube video player"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            class="w-full h-full"
          ></iframe>
        `;
      }
    }

    function closeModal() {
      if (modal && iframeContainer) {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        document.body.style.overflow = "";
        iframeContainer.innerHTML = "";
      }
    }

    triggers.forEach((trigger) => {
      trigger.addEventListener("click", openModal);
    });

    closeButton?.addEventListener("click", closeModal);

    modal?.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modal?.classList.contains("hidden")) {
        closeModal();
      }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const modals = document.querySelectorAll('[id^="modal-"]');
    modals.forEach((modal) => {
      const videoId = modal.id.split("-")[1];
      initializeModal(modal.id, videoId);
    });
  });
</script>

<style>
  .sermon-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .fixed {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .watch-button {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>
