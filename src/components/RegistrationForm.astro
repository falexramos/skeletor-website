---
// src/components/RegistrationForm.astro
import Modal from './Modal.astro';

export interface Props {
    endpoint: string;
    eventName: string;
}

const { endpoint, eventName } = Astro.props;
---
<div class="max-w-4xl mx-auto bg-gradient-to-br from-white via-slate-50 to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 p-8 rounded-2xl shadow-2xl dark:shadow-2xl border border-slate-200 dark:border-slate-700 backdrop-blur-sm">
  <!-- Header Section -->
  <div class="text-center mb-8">
    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-4 shadow-lg">
      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg>
    </div>
    <h2 class="text-4xl font-display font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">
      Formulario de Registro
    </h2>
    <p class="text-lg text-slate-600 dark:text-slate-300 max-w-md mx-auto">
      Completa tus datos para reservar tu lugar en este evento exclusivo
    </p>
  </div>

  <form id="registration-form" class="space-y-6">
    <!-- Personal Information Section -->
    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
      <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        Información Personal
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="form-group">
          <label for="nombreCompleto" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Nombre Completo *
          </label>
          <input 
            type="text" 
            id="nombreCompleto" 
            name="nombreCompleto" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder="Ingresa tu nombre completo"
          />
        </div>
        
        <div class="form-group">
          <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Email *
          </label>
          <input 
            type="email" 
            id="email" 
            name="email" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder="tu@email.com"
          />
        </div>
        
        <div class="form-group">
          <label for="telefono" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Teléfono *
          </label>
          <input 
            type="tel" 
            id="telefono" 
            name="telefono" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder=""
          />
        </div>
        
        <div class="form-group">
          <label for="ciudad" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Ciudad *
          </label>
          <input 
            type="text" 
            id="ciudad" 
            name="ciudad" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder="Tu ciudad"
          />
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <div class="form-group">
          <label for="direccion" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Dirección *
          </label>
          <input 
            type="text" 
            id="direccion" 
            name="direccion" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder="Tu dirección completa"
          />
        </div>
        
        <div class="form-group">
          <label for="comoNosConociste" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            ¿Cómo nos conociste? *
          </label>
          <select 
            id="comoNosConociste" 
            name="comoNosConociste" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
          >
            <option value="">Selecciona una opción</option>
            <option value="Sitio Web">Sitio Web</option>
            <option value="Redes Sociales">Redes Sociales</option>
            <option value="Amigo">Recomendación de un amigo</option>
            <option value="Email">Email marketing</option>
            <option value="Publicidad">Publicidad</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-1 gap-6 mt-6">
        <div class="form-group">
          <label for="deDondeNosVisitas" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            ¿De dónde nos visitas? *
          </label>
          <input 
            type="text" 
            id="deDondeNosVisitas" 
            name="deDondeNosVisitas" 
            required 
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 hover:border-slate-400 dark:hover:border-slate-500"
            placeholder="iglesia... comunidad, etc."
          />
        </div>
      </div>
    </div>

    <!-- Companions Section -->
    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-200 flex items-center">
          <svg class="w-5 h-5 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          Acompañantes
        </h3>
        <span class="text-sm text-slate-500 dark:text-slate-400">Opcional</span>
      </div>
      
      <div id="acompanantes-container" class="space-y-4 mb-4">
        <!-- Acompañantes will be added dynamically here -->
      </div>
      
      <button 
        id="add-acompanante-btn" 
        type="button" 
        class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-medium rounded-lg transition-all duration-200 transform hover:scale-105 shadow-md hover:shadow-lg"
      >
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        Agregar Acompañante
      </button>
    </div>

    <!-- Submit Button -->
    <div class="pt-6">
      <button 
        type="submit" 
        id="submit-btn" 
        class="w-full py-4 px-6 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-lg rounded-xl transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
      >
        <span class="flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Confirmar Registro
        </span>
      </button>
    </div>
  </form>
</div>

<!-- Modales para mensajes -->
<Modal 
  id="success-modal" 
  type="success" 
  title="¡Registro Exitoso!" 
  autoClose={true} 
  autoCloseDelay={5000}
  size="md"
  position="center"
/>

<Modal 
  id="error-modal" 
  type="error" 
  title="Error en el Registro" 
  showCloseButton={true}
  size="md"
  position="center"
/>

<Modal 
  id="loading-modal" 
  type="info" 
  title="Procesando..." 
  showCloseButton={false}
  backdrop={true}
  size="sm"
  position="center"
/>

<style>
  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
    }
  }
  
  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }
  
  .animate-pulse-glow {
    animation: pulse-glow 2s infinite;
  }
  
  /* Custom focus styles */
  .form-group input:focus,
  .form-group select:focus {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
  }
  
  /* Gradient text animation */
  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  .gradient-text {
    background: linear-gradient(-45deg, #3b82f6, #8b5cf6, #ec4899, #3b82f6);
    background-size: 400% 400%;
    animation: gradient-shift 3s ease infinite;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  /* Loading spinner */
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  .loading-spinner {
    animation: spin 1s linear infinite;
  }
</style>

<script define:vars={{ endpoint, eventName }}>
  // Simple UUID v4 generator function (no import needed)
  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c == 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }
  
  // Variables are now available directly from Astro props via define:vars
  console.log('Endpoint configurado:', endpoint);
  console.log('Nombre del evento:', eventName);
  
  // Add acompañante functionality
  document.getElementById('add-acompanante-btn')?.addEventListener('click', () => {
    const container = document.getElementById('acompanantes-container');
    const acompananteId = generateUUID();
    
    const acompananteHTML = `
      <div class="bg-gradient-to-r from-slate-50 to-blue-50 dark:from-slate-700 dark:to-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-600 relative shadow-sm animate-slide-up" data-id="${acompananteId}">
        <button 
          data-remove-id="${acompananteId}" 
          type="button" 
          class="absolute top-3 right-3 w-8 h-8 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-600 dark:text-red-400 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 shadow-sm"
          title="Eliminar acompañante"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        
        <div class="mb-4">
          <h4 class="text-lg font-semibold text-slate-800 dark:text-slate-200 flex items-center">
            <svg class="w-4 h-4 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            Acompañante
          </h4>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="form-group">
            <label for="acompananteNombre-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Nombre Completo *
            </label>
            <input 
              type="text" 
              id="acompananteNombre-${acompananteId}" 
              name="acompananteNombre-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder="Nombre del acompañante"
            />
          </div>
          
          <div class="form-group">
            <label for="acompananteEmail-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Email *
            </label>
            <input 
              type="email" 
              id="acompananteEmail-${acompananteId}" 
              name="acompananteEmail-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder="email@ejemplo.com"
            />
          </div>
          
          <div class="form-group">
            <label for="acompananteTelefono-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Teléfono *
            </label>
            <input 
              type="tel" 
              id="acompananteTelefono-${acompananteId}" 
              name="acompananteTelefono-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder=""
            />
          </div>
          
          <div class="form-group">
            <label for="acompananteCiudad-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Ciudad *
            </label>
            <input 
              type="text" 
              id="acompananteCiudad-${acompananteId}" 
              name="acompananteCiudad-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder="Ciudad"
            />
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
          <div class="form-group">
            <label for="acompananteDireccion-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Dirección *
            </label>
            <input 
              type="text" 
              id="acompananteDireccion-${acompananteId}" 
              name="acompananteDireccion-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder="Dirección completa"
            />
          </div>
          
          <div class="form-group">
            <label for="acompananteDeDondeNosVisitas-${acompananteId}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              ¿De dónde nos visita? *
            </label>
            <input 
              type="text" 
              id="acompananteDeDondeNosVisitas-${acompananteId}" 
              name="acompananteDeDondeNosVisitas-${acompananteId}" 
              required 
              class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 text-sm"
              placeholder="Iglesia... comunidad, etc."
            />
          </div>
        </div>
      </div>
    `;
    
    container?.insertAdjacentHTML('beforeend', acompananteHTML);
    
    // Add event listener to the new remove button
    const newRemoveBtn = container?.querySelector(`[data-remove-id="${acompananteId}"]`);
    newRemoveBtn?.addEventListener('click', () => {
      const acompananteDiv = newRemoveBtn.closest(`[data-id="${acompananteId}"]`);
      acompananteDiv?.remove();
    });
  });
  
  // Function to show modal messages
  function showModal(type, message) {
    if (type === 'success') {
      window.modalUtils?.['success-modal']?.show(message);
    } else if (type === 'error') {
      window.modalUtils?.['error-modal']?.show(message);
    } else if (type === 'loading') {
      window.modalUtils?.['loading-modal']?.show(message);
    }
  }
  
  function hideModal(type) {
    if (type === 'success') {
      window.modalUtils?.['success-modal']?.hide();
    } else if (type === 'error') {
      window.modalUtils?.['error-modal']?.hide();
    } else if (type === 'loading') {
      window.modalUtils?.['loading-modal']?.hide();
    }
  }
  
  // Function to set loading state
  function setLoading(loading) {
    const submitBtn = document.getElementById('submit-btn');
    if (submitBtn) {
      if (loading) {
        submitBtn.innerHTML = `
          <span class="flex items-center justify-center">
            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Registrando...
          </span>
        `;
        submitBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
        submitBtn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'hover:from-blue-700', 'hover:to-purple-700');
        submitBtn.disabled = true;
        showModal('loading', 'Procesando tu registro, por favor espera...');
      } else {
        submitBtn.innerHTML = `
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Confirmar Registro
          </span>
        `;
        submitBtn.classList.remove('bg-slate-400', 'cursor-not-allowed');
        submitBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'hover:from-blue-700', 'hover:to-purple-700');
        submitBtn.disabled = false;
        hideModal('loading');
      }
    }
  }
  
  // Form submission
  document.getElementById('registration-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    setLoading(true);
    
    const form = e.target;
    const formData = new FormData(form);
    const leadId = generateUUID();
    
    // Get all acompañante containers
    const acompananteContainers = document.querySelectorAll('#acompanantes-container > div[data-id]');
    const registros = [];
    
    // Main registration data
    const leadData = {
      id: leadId,
      evento: eventName,
      nombreCompleto: formData.get('nombreCompleto'),
      email: formData.get('email'),
      telefono: formData.get('telefono'),
      direccion: formData.get('direccion'),
      ciudad: formData.get('ciudad'),
      comoNosConociste: formData.get('comoNosConociste'),
      deDondeNosVisitas: formData.get('deDondeNosVisitas')
    };
    registros.push(leadData);
    
    // Add acompañante data
    acompananteContainers.forEach(container => {
      const acompananteId = container.getAttribute('data-id');
      const acompananteData = {
        id: generateUUID(),
        evento: eventName,
        nombreCompleto: formData.get(`acompananteNombre-${acompananteId}`),
        email: formData.get(`acompananteEmail-${acompananteId}`),
        telefono: formData.get(`acompananteTelefono-${acompananteId}`),
        direccion: formData.get(`acompananteDireccion-${acompananteId}`),
        ciudad: formData.get(`acompananteCiudad-${acompananteId}`),
        deDondeNosVisitas: formData.get(`acompananteDeDondeNosVisitas-${acompananteId}`),
        esAcompananteDe: leadId
      };
      registros.push(acompananteData);
    });
    
    console.log('Datos a enviar:', registros);
    console.log('Enviando a endpoint:', endpoint);
    
    try {
      const response = await fetch(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(registros)
      });
      
      const result = await response.json();
      console.log('Respuesta del servidor:', result);
      
      if (response.ok && result.statusCode === 200) {
        form.reset();
        document.getElementById('acompanantes-container').innerHTML = '';
        showModal('success', '¡Registro exitoso! Te esperamos. Recibirás un email de confirmación pronto.');
      } else {
        let errorMessage = 'Ocurrió un error. Inténtalo más tarde.';
        if (result.statusCode === 400) {
          errorMessage = 'Faltan datos obligatorios. Por favor, revisa tus campos.';
        } else if (result.statusCode === 409) {
          errorMessage = 'Ya existe un registro con este email para este evento.';
        } else if (result.statusCode >= 500) {
          errorMessage = 'Error del servidor. Por favor, inténtalo más tarde.';
        }
        showModal('error', errorMessage);
      }
    } catch (error) {
      console.error('Error al enviar datos:', error);
      if (error instanceof Error) {
        showModal('error', `Error de conexión: ${error.message}. Por favor, verifica tu conexión a internet e inténtalo más tarde.`);
      } else {
        showModal('error', 'Error de conexión. Por favor, verifica tu conexión a internet e inténtalo más tarde.');
      }
    } finally {
      setLoading(false);
    }
  });
</script>