---
import HeroSection from "@/components/HeroSection.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import "photoswipe/style.css";
import SimpleHeroSection from "@/components/SimpleHeroSection.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import Cta from "@/components/Cta.astro";

const currentLang = Astro.currentLocale || "es";


const categories = [
  {
    id: "dana",
    name: "Proyecto DANA",
    description: "Ayuda y reconstrucción tras las inundaciones",
    cover: "/assets/img/gallery/mires_dana_7.avif", 
  },
  {
    id: "food",
    name: "Alimentando Esperanza",
    description: "Distribución de alimentos y recursos básicos",
    cover: "/assets/img/gallery/mires_alimentando_esperanza_7.avif",
  },
  {
    id: "events",
    name: "Eventos Solidarios",
    description: "Actividades y encuentros comunitarios",
    cover: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_2.avif",
  },
  {
    id: "volunteers",
    name: "Voluntariado",
    description: "Nuestro equipo en acción",
    cover: "/assets/img/gallery/mires_colaboradores_4.avif",
  },
];


const images = [
  // Alimentando Esperanza
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_19.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_2.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_3.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_20.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_5.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_6.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_7.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  {
    src: "/assets/img/gallery/mires_alimentando_esperanza_8.avif",
    alt: "Alimentando Esperanza - MIRES",
    category: "food",
  },
  // Proyecto DANA
  {
    src: "/assets/img/gallery/mires_dana_1.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_2.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_3.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_4.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_5.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_6.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_7.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },
  {
    src: "/assets/img/gallery/mires_dana_8.avif",
    alt: "Proyecto DANA - MIRES",
    category: "dana",
  },

  // Eventos
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_1.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_2.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_3.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_4.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_5.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_6.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_7.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  {
    src: "/assets/img/gallery/mires_mas_que_un_regalo_navidad_8.avif",
    alt: "Eventos Solidarios - MIRES",
    category: "events",
  },
  // Voluntarios
  {
    src: "/assets/img/gallery/mires_colaboradores_2.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_3.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_4.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_5.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_6.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_7.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
  {
    src: "/assets/img/gallery/mires_colaboradores_8.avif",
    alt: "Voluntarios - MIRES",
    category: "volunteers",
  },
];

const heroData = {
  title: "Galería de Imágenes",
  description:
    "Un recorrido visual por nuestro trabajo y el impacto en la comunidad.",
};

const ctaData = {
  title:"¿Quieres colaborar con el Proyecto DANA?",
  description: "En MIRES, estos valores no son solo palabras. Son nuestra forma de vivir, servir y transformar vidas.",
  contactLink: getRelativeLocaleUrl(currentLang, "contact"),
  donateLink: getRelativeLocaleUrl(currentLang, "donate"),
  contactText: "Contáctanos",
  donateText: "Donar",
};
---

<BaseLayout title="Galería - MIRES">
  <!-- Hero Section -->
  <SimpleHeroSection {...heroData} />

  <!-- Cuadrícula de Categorías -->
  <section class="py-16 bg-lightbg dark:bg-darkbg">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        {
          categories.map((category) => (
            <button class="category-card group" data-category={category.id}>
              <div class="relative overflow-hidden rounded-2xl shadow-lg aspect-[16/9]">
                <img
                  src={category.cover}
                  alt={category.name}
                  class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent">
                  <div class="absolute bottom-0 left-0 right-0 p-6 text-left">
                    <h3 class="text-2xl font-bold text-white mb-2">
                      {category.name}
                    </h3>
                    <p class="text-white/90">{category.description}</p>
                  </div>
                </div>
              </div>
            </button>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Modal de Galería -->
  <div id="gallery-modal" class="fixed inset-0 bg-black/90 z-50 hidden">
    <button
      id="close-gallery"
      class="absolute top-4 right-4 text-white text-4xl">&times;</button
    >

    {
      categories.map((category) => (
        <div class="gallery-content hidden" data-category={category.id}>
          <h2 class="text-3xl font-bold text-white text-center mb-8 pt-8">
            {category.name}
          </h2>
          <div class="pswp-gallery container mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {images
              .filter((img) => img.category === category.id)
              .map((image) => (
                <a
                  href={image.src}
                  data-pswp-width="800"
                  data-pswp-height="600"
                  class="gallery-item"
                >
                  <div class="aspect-square overflow-hidden rounded-lg">
                    <img
                      src={image.src}
                      alt={image.alt}
                      class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                      loading="lazy"
                    />
                  </div>
                </a>
              ))}
          </div>
        </div>
      ))
    }
  </div>

  <Cta
    {...ctaData}
  />
</BaseLayout>

<style>
  .category-card {
    @apply w-full transform hover:-translate-y-1 transition-all duration-300;
  }

  #gallery-modal {
    overflow-y: auto;
  }

  .gallery-content {
    opacity: 0;
    transition: opacity 0.3s ease-out;
  }

  .gallery-content.active {
    opacity: 1;
  }
</style>

<script>
  import PhotoSwipeLightbox from "photoswipe/lightbox";

  // Inicializar PhotoSwipe
  const lightbox = new PhotoSwipeLightbox({
    gallery: ".pswp-gallery",
    children: ".gallery-item",
    pswpModule: () => import("photoswipe"),
    padding: { top: 20, bottom: 20, left: 20, right: 20 },
  });

  lightbox.init();

  // Manejo del modal
  const modal = document.getElementById("gallery-modal");
  const categoryCards = document.querySelectorAll(".category-card");
  const closeButton = document.getElementById("close-gallery");
  const galleryContents = document.querySelectorAll(".gallery-content");

  categoryCards.forEach((card) => {
    card.addEventListener("click", () => {
      const categoryId = (card as HTMLElement).dataset.category;
      if (modal) {
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      galleryContents.forEach((content) => {
        if ((content as HTMLElement).dataset.category === categoryId) {
          content.classList.remove("hidden");
          setTimeout(() => content.classList.add("active"), 100);
        } else {
          content.classList.add("hidden");
          content.classList.remove("active");
        }
      });
    });
  });

  if (closeButton) {
    closeButton.addEventListener("click", () => {
      if (modal) {
        modal.classList.add("hidden");
      }

      document.body.style.overflow = "auto";
      galleryContents.forEach((content) => {
        content.classList.remove("active");
      });
    });
  }

  // Cerrar con Escape
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      if (modal) {
        modal.classList.add("hidden");
      }
      document.body.style.overflow = "auto";
    }
  });
</script>
